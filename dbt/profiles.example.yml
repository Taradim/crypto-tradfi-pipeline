# dbt profiles configuration for DuckDB with S3 external storage
# Copy this file to profiles.yml and update with your actual AWS credentials
# cp dbt/profiles.example.yml dbt/profiles.yml

data_pipeline_portfolio:
  target: dev
  outputs:
    dev:
      type: duckdb
      path: "data_pipeline.duckdb" # Persistent database (required for multi-step dbt runs)

      # Extensions needed for S3 access
      extensions:
        - httpfs
        - parquet

      # S3 configuration using DuckDB settings
      # Credentials are loaded from environment variables
      settings:
        s3_region: "{{ env_var('AWS_DEFAULT_REGION', 'eu-west-1') }}"
        s3_access_key_id: "{{ env_var('AWS_ACCESS_KEY_ID') }}"
        s3_secret_access_key: "{{ env_var('AWS_SECRET_ACCESS_KEY') }}"

      # External materialization: write Parquet files to S3
      external_root: "s3://{{ env_var('S3_BUCKET_NAME') }}"
